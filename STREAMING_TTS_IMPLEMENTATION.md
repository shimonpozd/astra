# üéµ Streaming TTS Implementation

–°–∏—Å—Ç–µ–º–∞ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ TTS –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∞—É–¥–∏–æ **—Å—Ä–∞–∑—É** –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, —ç–∫–æ–Ω–æ–º—è –≤—Ä–µ–º—è –∏ —É–ª—É—á—à–∞—è UX.

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞

‚úÖ **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç** - –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É  
‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏** - –Ω–µ –∂–¥–µ–º –ø–æ–ª–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏  
‚úÖ **–õ—É—á—à–∏–π UX** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ª—ã—à–∏—Ç –∞—É–¥–∏–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ  
‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏** - –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –≤–µ—Å—å —Ñ–∞–π–ª –≤ –ø–∞–º—è—Ç—å  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ —Ç–µ–∫—Å—Ç–∞  

## üìÅ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å—Ç—Ä–∏–º–∏–Ω–≥–∞

### 1. **SimpleStreamingTTS** - –ü—Ä–æ—Å—Ç–æ–π —Å—Ç—Ä–∏–º–∏–Ω–≥
```tsx
<SimpleStreamingTTS
  text="–¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏"
  language="en"
  voiceId="yandex-oksana"
  speed={1.0}
/>
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- üéØ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- ‚ö° **–ë—ã—Å—Ç—Ä–æ—Ç–∞** - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ** - –Ω–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä–∞—Ç—å —Å—Ä–∞–∑—É

### 2. **StreamingAudioMessage** - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Å—Ç—Ä–∏–º–∏–Ω–≥
```tsx
<StreamingAudioMessage
  text="–¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏"
  chatId="chat-123"
  voiceId="yandex-oksana"
  onAudioSaved={(message) => console.log('Saved:', message)}
/>
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- üéõÔ∏è **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** - –ø–∞—É–∑–∞, –ø–µ—Ä–µ–º–æ—Ç–∫–∞, –ø—Ä–æ–≥—Ä–µ—Å—Å
- üíæ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —á–∞—Ç
- üìä **–ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä** - –≤–∏–¥–Ω–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- üì• **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ** - –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ

### 3. **useStreamingTTS** - –•—É–∫ –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
```typescript
const {
  isPlaying,
  isLoading,
  error,
  currentTime,
  duration,
  play,
  pause,
  stop,
  seek
} = useStreamingTTS({
  voiceId: 'yandex-oksana',
  language: 'en',
  speed: 1.0
});

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
await play("–¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏");
```

## üîÑ –ü–æ—Ç–æ–∫ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞

### 1. **–ò–Ω–∏—Ü–∏–∞—Ü–∏—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞**
```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
const response = await fetch('/api/tts/stream', {
  method: 'POST',
  body: JSON.stringify({
    text: "–¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏",
    language: "en",
    voice_id: "yandex-oksana",
    speed: 1.0
  })
});
```

### 2. **–°–æ–∑–¥–∞–Ω–∏–µ MediaSource**
```typescript
const mediaSource = new MediaSource();
const audioUrl = URL.createObjectURL(mediaSource);
const audio = new Audio(audioUrl);
```

### 3. **–ß—Ç–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞**
```typescript
const reader = response.body.getReader();
while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  
  // –î–æ–±–∞–≤–ª—è–µ–º –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä
  sourceBuffer.appendBuffer(value);
}
```

### 4. **–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ**
```typescript
// –ê—É–¥–∏–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä–∞—Ç—å —Å—Ä–∞–∑—É, –∫–∞–∫ —Ç–æ–ª—å–∫–æ
// –ø–µ—Ä–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç –≤ –±—É—Ñ–µ—Ä
audio.play();
```

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### **–ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ**
```tsx
// –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
<SimpleStreamingTTS text={messageText} />
```

### **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —á–∞—Ç**
```tsx
// –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—É–¥–∏–æ –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏—è
<StreamingAudioMessage 
  text={messageText}
  chatId={currentChatId}
  onAudioSaved={handleAudioSaved}
/>
```

### **–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**
```tsx
// –î–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
const streamingTTS = useStreamingTTS();

const handlePlay = () => {
  streamingTTS.play("–¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏");
};
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### **MediaSource API**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `MediaSource` –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `audio/mpeg`, `audio/ogg`, `audio/wav`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–∏–µ

### **TTS Backend**
- Endpoint: `POST /api/tts/stream`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤: Yandex, ElevenLabs, XTTS, Orpheus
- –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ —Å–±–æ—è—Ö
- Fallback –Ω–∞ –æ–±—ã—á–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ü–æ–¥—Ö–æ–¥ | –°–∫–æ—Ä–æ—Å—Ç—å | –§—É–Ω–∫—Ü–∏–∏ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|--------|----------|---------|-----------|
| **–û–±—ã—á–Ω—ã–π TTS** | –ú–µ–¥–ª–µ–Ω–Ω–æ | –ë–∞–∑–æ–≤—ã–µ | –ü—Ä–æ—Å—Ç–∞—è |
| **SimpleStreaming** | –ë—ã—Å—Ç—Ä–æ | –ë–∞–∑–æ–≤—ã–µ | –ü—Ä–æ—Å—Ç–∞—è |
| **StreamingMessage** | –ë—ã—Å—Ç—Ä–æ | –ü–æ–ª–Ω—ã–µ | –°—Ä–µ–¥–Ω—è—è |
| **–ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π** | –ë—ã—Å—Ç—Ä–æ | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ | –°–ª–æ–∂–Ω–∞—è |

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### **–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è:**
```tsx
<SimpleStreamingTTS text={text} />
```

### **–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —á–∞—Ç:**
```tsx
<StreamingAudioMessage 
  text={text} 
  chatId={chatId}
  onAudioSaved={handleSave}
/>
```

### **–î–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏:**
```tsx
const streamingTTS = useStreamingTTS();
// –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∏—Ç—Ä–µ–π—Ç–∞ –ø–æ —Å–µ—Ç–∏
- [ ] **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ñ—Ä–∞–∑
- [ ] **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏** - –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞—É–¥–∏–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- [ ] **–£–º–Ω–∞—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è** - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ—Ä–∞–∑
- [ ] **–û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ —Å–µ—Ç–∏

## üéµ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å **—Ç—Ä–∏ —É—Ä–æ–≤–Ω—è** TTS:

1. **‚ö° SimpleStreaming** - –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
2. **üéõÔ∏è StreamingMessage** - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ  
3. **üíæ AudioMessage** - –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —á–∞—Ç–µ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç **–ª—É—á—à–∏–π –æ–ø—ã—Ç** - –∞—É–¥–∏–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä–∞—Ç—å —Å—Ä–∞–∑—É, –∞ –Ω–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è! üöÄ


